<!DOCTYPE html>
<html lang="en">
<head>
    <title>IXD BIKER @2023</title>

    <link rel="stylesheet" href="leaflet.css"/>

    <link rel="stylesheet" href="leaflet-routing-machine.css" />
    <link rel="stylesheet" href="L.Control.Locate.min.css" />
    <script>
        var config = {
    map: {
        is_google_statellite:false,
        is_showing_meter:true,
        auto_routing:false,
        auto_zoom:false,
        maker: "images/maker.png",
        type: "hybrid",
        key: "AIzaSyB3W5D8BP4I2KLTbTlHaFndHve9RV7A-4k",
        width: 500,
        height: 500,
        speed: 0,
        zoom: 17,
        maxZoom: 18,
        minZoom: 13,
        lat: 0,
        long: 0,
        accuracy: 0,
        timeout: 5000,
        timereset: 100,
    },
    meter: {
        width: 500,
        height: 500,
        maxseed: 150,
        rpm: .1,
        gear: "N",
    }
}

function toggleFullScreen() {
    let elem = document.querySelector("body");

     // ## The below if statement seems to work better ## if ((document.fullScreenElement && document.fullScreenElement !== null) || (document.msfullscreenElement && document.msfullscreenElement !== null) || (!document.mozFullScreen && !document.webkitIsFullScreen)) {
    if ((document.fullScreenElement !== undefined && document.fullScreenElement === null) || (document.msFullscreenElement !== undefined && document.msFullscreenElement === null) || (document.mozFullScreen !== undefined && !document.mozFullScreen) || (document.webkitIsFullScreen !== undefined && !document.webkitIsFullScreen)) {
        if (elem.requestFullScreen) {
            elem.requestFullScreen();
        } else if (elem.mozRequestFullScreen) {
            elem.mozRequestFullScreen();
        } else if (elem.webkitRequestFullScreen) {
            elem.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
        } else if (elem.msRequestFullscreen) {
            elem.msRequestFullscreen();
        }
       // document.addEventListener("mousedown", toggleFullScreen);

    } else {
        if (document.cancelFullScreen) {
            document.cancelFullScreen();
        } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        } else if (document.webkitCancelFullScreen) {
            document.webkitCancelFullScreen();
        } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
      //  document.removeEventListener("mousedown", toggleFullScreen);
    }
}


    </script>

    <script defer src="teslahud.js"></script>
</head>
<body class="body">    
    <main>
        <div id="map" style="width:100vw;height: 100vh;">
            <div class="leaflet-control coordinate"></div>
            <div class="hud">
                <canvas id="canvas"></canvas>
            </div>
            <div class="log" id="log"></div>

            <div class="hud hud-text">
                <span class="hud-text_content">
                    <img src="images/fb.png" width="40" height="40"> @uhpd.x  &nbsp;
                   <img src="images/tiktok.png" width="35" height="35"> @ixd_biker  &nbsp;
                   <img src="images/ytb.png" width="35" height="35">@ungdang  &nbsp;
                   <img src="images/steam.png" width="35" height="35"> @uhpd_games  &nbsp;
                </span>
            </div>
        </div>
    
    </main>
<footer>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

<div class="navigation">
    <ul>
        <li class="list">
            <a href="javascript:void(0);" id="sw-planet" onclick="updateTitlePlanet();">
                <span class="icon">
                    <ion-icon id="icon-planet" class="planet-off"></ion-icon>
                </span>
                <span class="text">home</span>
            </a>
        </li>
        <li class="list">
            <a href="javascript:void(0);" onclick="updateTitleDefault();">
                <span class="icon">
                    <ion-icon id="icon-mapdefalut" class="mapdefalut-off"></ion-icon>
                </span>

                <span class="text">map</span>
            </a>
        </li>
        <li class="list">
            <a href="javascript:void(0);" onclick="update_auto_routing_map();"> 
                <span class="icon">
                    <ion-icon id="icon-routing" class="routing-off"></ion-icon>
                </span>
                <span class="text">routing</span>
            </a>
        </li>
        <li class="list">
           
            <a href="javascript:void(0);" onclick="update_show_meter();"> 
                <span class="icon">
                    <ion-icon id="icon-meter" class="meter-on"></ion-icon>
                </span>
                <span class="text">meter</span>
            </a>
        </li>
        <li class="list ">
            <a href="javascript:void(0);" onclick="update_auto_zoom_map();"> 
                <span class="icon">
                    <ion-icon id="icon-zoom" class="zoom-off"></ion-icon>
                </span>
                <span class="text">zoom</span>
            </a>

            
        </li>

        <li class="list active">
            <a href="javascript:void(0)" onclick="toggleFullScreen();">
                <span class="icon"><ion-icon name="scan-circle-outline"></ion-icon></span>
                <span class="text">toggle Full</span></a>
        </li>

    </ul>


   
</div>

<link rel="stylesheet" href="menu.css">

<script>
    /*var list = document.querySelectorAll('.list');

    function activeLink() {
        list.forEach(item => {
            item.classList.remove('active');
            this.classList.add('active');
        })
    }

    list.forEach(item => {
        item.addEventListener('click', activeLink)
    })*/
</script>
</footer>

    <script src="leaflet.js"></script>
    <script src="leaflet-routing-machine.js"></script>
    <script src="L.Control.Locate.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>     
    
    <script>
        if(!navigator.geolocation){
    
        }else {
            navigator.geolocation.getCurrentPosition(function (position){
                config.map.lat = position.coords.latitude;
                config.map.long = position.coords.longitude;
            });
        }
    
        var map = undefined;
        setTimeout(function (){
           
            //map = L.map('map').setView([config.map.lat, config.map.long], config.map.zoom);
            osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: config.map.maxZoom,
                
            });
            map = L.map('map',{
                center: [config.map.lat, config.map.long],
                zoom: config.map.zoom,
                maxZoom:config.map.maxZoom,
                preferCanvas:true,
                keyboard:false,
                touchZoom:true,
                layers: [osm],

            });
           
           // osm.addTo(map);
    
            // dark map
            dark = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                subdomains: 'abcd',
                maxZoom: config.map.maxZoom,
            });
            // dark.addTo(map)
    
            // google street
            googleStreets = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
                maxZoom:  config.map.maxZoom  + 5,
                subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
            });
            // googleStreets.addTo(map);
    
            //google satellite
            googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
                maxZoom: config.map.maxZoom  + 5,
                
                subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
            });
            // googleSat.addTo(map)
    
    
            var taxiIcon = L.icon({
                iconUrl: config.map.maker,
                iconSize: [70, 70],
                className: 'blinking'
            })
    
            var marker = L.marker([config.map.lat,config.map.long], { icon: taxiIcon }).addTo(map);
            
            
            L.DomUtil.addClass(marker._icon, "blinking");

    
            /*==============================================
                            LAYER CONTROL
            ================================================*/
            
            L.control
            .locate({
                strings: {
                title: "Show me where I am, yo!"
                }
            })
            .addTo(map);
            
            L.Control.geocoder().addTo(map);

            /*
            L.Control.MyControl = L.Control.extend({
                onAdd: function(map) {
                var el = L.DomUtil.create('div', 'leaflet-bar my-control');

                el.innerHTML = ' ';//my control
    //<a href="javascript:void(0);" onclick="update_auto_zoom_map();" style="outline: none;"> <img id="icon_zoom" src="zoom-out.png" width="100"> </a>

                return el;
            },

            onRemove: function(map) {
                // Nothing to do here
            }
            });

            L.control.myControl = function(opts) {
            return new L.Control.MyControl(opts);
            }
            L.control.myControl({
            position: 'topright'
            }).addTo(map);

            */
var NASAGIBS_ViirsEarthAtNight2012 = L.tileLayer('https://map1.vis.earthdata.nasa.gov/wmts-webmerc/VIIRS_CityLights_2012/default/{time}/{tilematrixset}{maxZoom}/{z}/{y}/{x}.{format}', {
	minZoom: 1,
	maxZoom: config.map.maxZoom,
	format: 'jpg',
	time: '',
	tilematrixset: 'GoogleMapsCompatible_Level'
});
var OpenTopoMap = L.tileLayer('https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryTopo/MapServer/tile/{z}/{y}/{x}', {
	maxZoom: config.map.maxZoom,
});
            var baseMaps = {
                "OSM": osm,
                "US GOV":OpenTopoMap,  
                "NASA 2012":NASAGIBS_ViirsEarthAtNight2012,
                'Dark': dark,
                'Google Map': googleStreets,
                "Satellite": googleSat,
            };
    
            // map.removeLayer(singleMarker)
    
    
            var overlayMaps = {}
            L.control.layers(baseMaps, overlayMaps, {collapsed: true}).addTo(map);
     
                
    
            map.on('click', function (e) {
    
    /*  if (marker) {
          map.removeLayer(marker)
      }*/

      

      if(config.map.auto_routing == true){
       var marker_waypoint =  L.marker([e.latlng.lat, e.latlng.lng]).addTo(map);
        L.DomUtil.addClass(marker_waypoint._icon, 'icon-waypoint');

        L.Routing.control({
          waypoints: [
              L.latLng(config.map.lat, config.map.long),
              L.latLng(e.latlng.lat, e.latlng.lng)
          ]
      }).on('routesfound', function (e) {
          var routes = e.routes;
          //console.log(routes);

          e.routes[0].coordinates.forEach(function (coord, index) {
              setTimeout(function () {
                  marker.setLatLng([coord.lat, coord.lng]);
              }, 100 * index)
          })

        }).addTo(map);
      }
      
        
    });


        //clearTimeout();


        map.on('mousemove', function (e) {
        document.getElementsByClassName('coordinate')[0].innerHTML = e.latlng.lat + ',' + e.latlng.lng;
        }) 
        map.on('mouseover', function () {
            //  console.log('your mouse is over the map')
        })
        }, 1000);
    
    
//watch

let id;
let target;
let options;

var marker, circle;

function getPosition(position) {

    updateGEO(position);

    if (typeof map != 'undefined' && typeof L != 'undefined') {
        if (marker) {
            map.removeLayer(marker)
        }

         if (circle) {
             map.removeLayer(circle)
         }

        marker = L.marker([config.map.lat, config.map.long])
        circle = L.circle([config.map.lat, config.map.long])

        var featureGroup = L.featureGroup([marker, circle]).addTo(map);//[marker, circle]

        map.fitBounds(featureGroup.getBounds())
    }
}

var uu = 0;
function updateMAP() {
    console.log('count __' + uu++);

    function success(pos) {
        const crd = pos.coords;

        if (target.latitude === crd.latitude && target.longitude === crd.longitude) {
            navigator.geolocation.clearWatch(id);
        } else {
            getPosition(pos);
            
           
            if(config.map.auto_zoom == true)
            {
                map.setZoom(config.map.zoom);
            }
        }

    }

    function error(err) {

        mylog(`ERROR(${err.code}): ${err.message}`)
        //console.error();
    }

    target = {
        latitude: 0,
        longitude: 0
    };

    options = {
        zoom: config.map.zoom,
        desiredAccuracy: 1,
        frequency: config.map.timereset,
        enableHighAccuracy: false,
        timeout: config.map.timeout,
        maximumAge: 0
    };

    id = navigator.geolocation.watchPosition(success, error, options);
}

function updateGEO(position) {
    config.map.lat = position.coords.latitude
    config.map.long = position.coords.longitude
    config.map.accuracy = position.coords.accuracy
    config.map.speed = position.coords.speed;
}


function mylog(data = '') {
    var log = document.getElementById('log');
    if (typeof log != 'undefined') {
        log.innerHTML = data;
    }
}


function updateTitlePlanet(){
    if (map.hasLayer(googleSat)) {
        map.addLayer(googleStreets);
        map.removeLayer(googleSat);
        document.getElementById('icon-planet').classList.add('planet-off');
        document.getElementById('icon-planet').classList.remove('planet-on');
        is_google_statellite = false;
    } else {
        map.addLayer(googleSat);
        map.removeLayer(googleStreets);
        document.getElementById('icon-planet').classList.add('planet-on');
        document.getElementById('icon-planet').classList.remove('planet-off');
        is_google_statellite = true;
    }

    document.getElementById('icon-mapdefalut').classList.add('mapdefalut-off');
    document.getElementById('icon-mapdefalut').classList.remove('mapdefalut-on');
}
 


function updateTitleDefault(){
    if(is_google_statellite == true){
        document.getElementById('icon-mapdefalut').classList.add('mapdefalut-off');
        document.getElementById('icon-mapdefalut').classList.remove('mapdefalut-on');
        return false;
    }

    if (map.hasLayer(osm)) {
        map.addLayer(googleStreets);
        map.removeLayer(osm);
        document.getElementById('icon-mapdefalut').classList.add('mapdefalut-off');
        document.getElementById('icon-mapdefalut').classList.remove('mapdefalut-on');
        
    } else {
    
        document.getElementById('icon-mapdefalut').classList.add('mapdefalut-on');
        document.getElementById('icon-mapdefalut').classList.remove('mapdefalut-off');
        map.addLayer(osm);
        map.removeLayer(googleStreets);
    }
}
 


function removeElementsByClass(className){
    const elements = document.getElementsByClassName(className);
    while(elements.length > 0){
        elements[0].parentNode.removeChild(elements[0]);
    }
}
document.addEventListener('DOMContentLoaded', function () {
        setInterval(drawSpeedo, config.map.timereset);
        setInterval(updateMAP, 5000);
    }, false);


    function update_auto_routing_map(){
        if(config.map.auto_routing === false)
        {
            
            document.getElementById('icon-routing').classList.add('routing-on');
            document.getElementById('icon-routing').classList.remove('routing-off');
             config.map.auto_routing = true;
        }else{
            document.getElementById('icon-routing').classList.add('routing-off');
            document.getElementById('icon-routing').classList.remove('routing-on');
            
            config.map.auto_routing = false;

            removeElementsByClass('leaflet-routing-container');
            removeElementsByClass('leaflet-overlay-pane');
        
            
            document.querySelectorAll('.leaflet-marker-pane img').forEach((img) => img.remove());
            document.querySelectorAll('.leaflet-shadow-pane img').forEach((img) => img.remove());
            
            
        }
    }

    function update_show_meter(){
        if(config.map.is_showing_meter === false)
        {    
            document.getElementById('canvas').classList.remove('hidden');
            document.getElementById('icon-meter').classList.add('meter-on');
            document.getElementById('icon-meter').classList.remove('meter-off');
            config.map.is_showing_meter = true;
        }else{
            document.getElementById('canvas').classList.add('hidden');
            document.getElementById('icon-meter').classList.add('meter-off');
            document.getElementById('icon-meter').classList.remove('meter-on');
            
            config.map.is_showing_meter = false
        }
    }
    
    function update_auto_zoom_map(){
        if(config.map.auto_zoom === false)
        {
            
            document.getElementById('icon-zoom').classList.add('zoom-in');
            document.getElementById('icon-zoom').classList.remove('zoom-off');
            config.map.auto_zoom = true;
        }else{
            document.getElementById('icon-zoom').classList.add('zoom-off');
            document.getElementById('icon-zoom').classList.remove('zoom-in');
            config.map.auto_zoom = false
        }
    }
     
    </script>


<style>
.leaflet-bar {
  box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 5px;
}

    body {
          width: 100vw;
          height: 100vh;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        main{
            height:auto;
        }

        footer{
            position: absolute;
    bottom: 0;
    z-index: 9999;
    left: 0;
  
        }
       .hud{
            position: absolute;
            /* top:0;
            left: 25%; */
            right: 0;
            bottom: 0;
            z-index: 99999;
        }
        canvas{
            height: 20em;
            margin-bottom: 3em;

        }

</style>
</body>
</html>